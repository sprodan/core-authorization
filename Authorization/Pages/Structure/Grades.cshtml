@page
@model Authorization.Pages.Structure.GradesModel
@{
}

<div class="row animated fadeInRightBig">
    <div class="col-lg-12">
        <div class="wrapper wrapper-content">
            @foreach (var department in Model.Departments)
            {
                <div class="col-md-6">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>@department.Name</h5>
                        </div>
                        <div class="ibox-content" id="@department.Id">
                            <form method="post">
                                <table class="table" id="positionTable">
                                    <thead>
                                        <tr>
                                            <th>Грейд</th>
                                            <th>Название</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var position in department.Positions)
                                        {
                                            <tr id="@position.Id">
                                                <td id="positionGrade">@position.Grade</td>
                                                <td id="positionName">@position.Name</td>
                                                <td style="width: 25%">
                                                    <a class="btn btn-xs btn-danger pull-right" onclick="deletePosition(@position.Id)" style="margin-left: 2px">
                                                        <i class="fa fa-times"></i>
                                                    </a>
                                                    <a class="btn btn-xs btn-warning pull-right" onclick="editRole(@position.Id, '@position.Name', @position.Grade)">
                                                        <i class="fa fa-pencil"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </form>
                        </div>
                        <div class="ibox-footer">
                            <div class="text-center">
                                <a class="btn btn-primary" onclick="addPosition(@department.Id, '@department.Name')">Добавить позицию</a>
                            </div>
                            
                        </div>
                    </div>

                </div>
            }
            <div id="addposition-modal" class="modal fade" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-sm-12">
                                    <h3 class="m-t-none m-b">Добавить</h3>
                                    <h4 class="m-t-none m-b" id="addModalDepartmentName"></h4>
                                    <form role="form" id="addPosition">
                                        <input type="hidden" name="departmentId" id="addModalDepartmentId" />
                                        <div class="form-group"><label>Название</label> <input type="text" placeholder="Название" class="form-control" name="name"></div>
                                        <div class="form-group">
                                            <label>Грейд</label>
                                            <select class="form-control" name="grade">
                                                @for (var i = 1; i < 10; i++)
                                                {
                                                    <option value="@i">@i</option>
                                                }
                                            </select>
                                        </div>
                                        <div>
                                            <button class="btn btn-sm btn-primary pull-right m-t-n-xs" type="submit"><strong>Добавить</strong></button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="editposition-modal" class="modal fade" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-sm-12">
                                    <h3 class="m-t-none m-b">Изменить позицию</h3>
                                    <form role="form" id="editRoleForm">
                                        <input type="hidden" id="idEditRoleForm" name="id" />
                                        <div class="form-group"><label>Название</label> <input id="nameEditRoleForm" type="text" placeholder="Название" class="form-control" name="name" value=""></div>
                                        <div>
                                            <button class="btn btn-sm btn-primary pull-right m-t-n-xs" type="submit"><strong>Изменить</strong></button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
</div>
<script>
    var addForm = $("#addPosition");
    addForm.on("submit", function (event) {
        event.preventDefault();
        var data = addForm.serialize();
        var token = $('[name=__RequestVerificationToken]').val();
        $.ajax({
            url: "/Structure/Grades?handler=addPosition",
            type: 'POST',
            dataType: "json",
            data: { __RequestVerificationToken: token, jsonRequest: data },
            success: function (response) {
                $('#addposition-modal').modal('hide');
                switch (response.code) {
                    case 200:
                        var row = $("#" + response.departmentId).find("#roleTable tr").filter(function () { return $(this).attr("id") == response.role.id });
                        //row.find("#positionName").html(response.role.name); TODO: ADD POSITION AND SORT TABLE
                        break;
                    default:
                        break;
                }
            }
        });

    });
    function addPosition(id, name) {
        $("#addModalDepartmentId").val(id);
        $("#addModalDepartmentName").html(name);
        $('#addposition-modal').modal('show');
    }


</script>
