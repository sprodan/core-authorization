@page
@model Authorization.Pages.Structure.Employee.AddModel
@{
}

@Html.AntiForgeryToken();
<div class="row animated fadeInRightBig">
    <div class="col-lg-12">
        <div class="wrapper wrapper-content">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    Введите данные сотрудника
                </div>
                <div class="ibox-content" >
                    <div class="sk-spinner sk-spinner-wave">
                              <div class="sk-rect1"></div>
                              <div class="sk-rect2"></div>
                              <div class="sk-rect3"></div>
                              <div class="sk-rect4"></div>
                              <div class="sk-rect5"></div>
                        
                    </div>
                    <form id="add-form">
                        <div class="form-group row">
                            <div class="col-sm-2"><label>ФИО</label></div>
                            <div class="col-sm-10"><input type="text" class="form-control" placeholder="ФИО" required=""></div>
                        </div>
                        <div class="form-group row">
                            <div class="col-sm-2"><label>Отдел</label></div>
                            <div class="col-sm-10" id="department-select-box">
                                
                                <select name="departmentId" id="department-select" class="form-control">
                                    @foreach(var department in Model.Departments)
                                    {
                                        <option value="@department.Id">@department.Name</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-sm-2"><label>Позиция</label></div>
                            <div class="col-sm-10" >
                                
                                <select name="positionId" id="position-select" class="form-control">
                                    @foreach(var position in Model.Departments[0].Positions)
                                    {
                                        <option value="@position.Id">@position.Name</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-sm-2"><label>Команда</label></div>
                            <div class="col-sm-10" >
                                <select name="teamId" id="team-select" class="form-control">
                                    @foreach(var team in Model.Departments[0].Teams)
                                    {
                                        <option value="@team.Id">@team.Name</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary block full-width m-b">Сохранить</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    
    $("#department-select").on("change", function (e) {
        $(".ibox-content").toggleClass('sk-loading');
        $("#position-select").empty();
        $("#team-select").empty();
        var id = $("#department-select").val();
        var token = $('[name=__RequestVerificationToken]').val();
        $.ajax({
            url: "/Structure/Teams?handler=Json",
            type: 'GET',
            dataType: "json",
            data: { __RequestVerificationToken: token, departmentId: id },
            success: function (response) {
                $(".ibox-content").toggleClass('sk-loading');
                switch (response.code) {
                    case "200":
                        if (response.teams != null && response.teams.length != 0) {
                            for (var i = 0; i < response.teams.length; i++) {
                                $('#team-select')
                                    .append($("<option></option>")
                                        .attr("value", response.teams[i].id)
                                        .text(response.teams[i].name));
                            }
                        }
                        break;
                    default:
                        break;
                }
            }
        });
        $.ajax({
            url: "/Structure/Grades?handler=Json",
            type: 'GET',
            dataType: "json",
            data: { __RequestVerificationToken: token, departmentId: id },
            success: function (response) {
                switch (response.code) {
                    case "200":
                        if (response.positions != null && response.positions.length != 0) {
                                for (var i = 0; i < response.positions.length; i++) {
                                $('#position-select')
                                    .append($("<option></option>")
                                        .attr("value", response.positions[i].id)
                                        .text(response.positions[i].name));
                            }
                        }
                        break;
                    default:
                        break;
                }
            }
        });
        
    });
</script>